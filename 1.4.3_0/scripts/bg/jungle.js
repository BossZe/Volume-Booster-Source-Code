function createFadeBuffer(e,t,a){var i=t*e.sampleRate;t=i+(t-2*a)*e.sampleRate;var r=e.createBuffer(1,t,e.sampleRate),n=r.getChannelData(0);a=i-(e=a*e.sampleRate);for(var f=0;f<i;++f)n[f]=f<e?Math.sqrt(f/e):f>=a?Math.sqrt(1-(f-a)/e):1;for(f=i;f<t;++f)n[f]=0;return r}function createDelayTimeBuffer(e,t,a,i){var r=t*e.sampleRate;t=r+(t-2*a)*e.sampleRate,a=(e=e.createBuffer(1,t,e.sampleRate)).getChannelData(0);for(var n=0;n<r;++n)a[n]=i?(r-n)/t:n/r;for(n=r;n<t;++n)a[n]=0;return e}var delayTime=.01,fadeTime=.05,bufferTime=.1;function Jungle(e){this.context=e;var t=e.createGain(),a=e.createGain();this.input=t,this.output=a;var i=e.createBufferSource(),r=e.createBufferSource(),n=e.createBufferSource(),f=e.createBufferSource();this.shiftDownBuffer=createDelayTimeBuffer(e,bufferTime,fadeTime,!1),this.shiftUpBuffer=createDelayTimeBuffer(e,bufferTime,fadeTime,!0),i.buffer=this.shiftDownBuffer,r.buffer=this.shiftDownBuffer,n.buffer=this.shiftUpBuffer,f.buffer=this.shiftUpBuffer,i.loop=!0,r.loop=!0,n.loop=!0,f.loop=!0;var c=e.createGain(),s=e.createGain(),o=e.createGain();o.gain.setValueAtTime(0,e.currentTime);var m=e.createGain();m.gain.setValueAtTime(0,e.currentTime),i.connect(c),r.connect(s),n.connect(o),f.connect(m);var u=e.createGain(),h=e.createGain(),T=e.createDelay(),l=e.createDelay();c.connect(u),s.connect(h),o.connect(u),m.connect(h),u.connect(T.delayTime),h.connect(l.delayTime);var d=e.createBufferSource(),g=e.createBufferSource(),G=createFadeBuffer(e,bufferTime,fadeTime);d.buffer=G,g.buffer=G,d.loop=!0,g.loop=!0,G=e.createGain();var p=e.createGain();G.gain.setValueAtTime(0,e.currentTime),p.gain.setValueAtTime(0,e.currentTime),d.connect(G.gain),g.connect(p.gain),t.connect(T),t.connect(l),T.connect(G),l.connect(p),G.connect(a),p.connect(a),t=(e=e.currentTime+.05)+bufferTime-fadeTime,i.start(e),r.start(t),n.start(e),f.start(t),d.start(e),g.start(t),this.mod1=i,this.mod2=r,this.mod1Gain=c,this.mod2Gain=s,this.mod3Gain=o,this.mod4Gain=m,this.modGain1=u,this.modGain2=h,this.fade1=d,this.fade2=g,this.mix1=G,this.mix2=p,this.delay1=T,this.delay2=l,this.setDelay(delayTime)}Jungle.prototype.setDelay=function(e){this.modGain1.gain.setTargetAtTime(.5*e,0,.01),this.modGain2.gain.setTargetAtTime(.5*e,0,.01)};var previousPitch=-1;Jungle.prototype.setPitchOffset=function(e){0<e?(this.mod1Gain.gain.setTargetAtTime(0,0,.01),this.mod2Gain.gain.setTargetAtTime(0,0,.01),this.mod3Gain.gain.setTargetAtTime(1,0,.01),this.mod4Gain.gain.setTargetAtTime(1,0,.01)):(this.mod1Gain.gain.setTargetAtTime(1,0,.01),this.mod2Gain.gain.setTargetAtTime(1,0,.01),this.mod3Gain.gain.setTargetAtTime(0,0,.01),this.mod4Gain.gain.setTargetAtTime(0,0,.01)),this.setDelay(delayTime*Math.abs(e)),previousPitch=e};